package com.laynefong.hodgepodge;

import com.alibaba.fastjson.JSONObject;
import com.alibaba.fastjson.TypeReference;
import com.laynefong.hodgepodge.domain.SolutionDeviceDpStatBaseEntity;
import com.laynefong.hodgepodge.domain.StatListVO;

import java.math.BigDecimal;
import java.util.ArrayList;
import java.util.List;
import java.util.Objects;

/**
 * @Author Banchao
 * @Date 2022/4/2 14:57
 */
public class Junit17 {

    public static void main(String[] args) {
        String _a =
                "[{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042000\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515340,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":101.00,\"rangeValue\":101.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042001\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515341,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":98.00,\"rangeValue\":98.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042004\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515342,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":101.00,\"rangeValue\":101.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042002\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515343,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":101.00,\"rangeValue\":101.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042005\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515344,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":98.00,\"rangeValue\":98.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042003\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515345,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":99.00,\"rangeValue\":99.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042010\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515630,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":101.00,\"rangeValue\":101.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042014\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515631,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":86.00,\"rangeValue\":86.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042015\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515632,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":87.00,\"rangeValue\":87.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042017\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515633,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":85.00,\"rangeValue\":85.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042011\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515634,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":99.00,\"rangeValue\":99.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042012\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515635,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":98.00,\"rangeValue\":98.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042016\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515636,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":90.00,\"rangeValue\":90.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042018\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515637,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":99.00,\"rangeValue\":99.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042013\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515638,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":91.00,\"rangeValue\":91.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042019\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515639,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":98.00,\"rangeValue\":98.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042023\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515640,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":200.00,\"rangeValue\":100.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042022\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515641,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":204.00,\"rangeValue\":102.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042006\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515642,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":97.00,\"rangeValue\":97.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042009\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515643,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":89.00,\"rangeValue\":89.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042020\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515644,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":104.00,\"rangeValue\":104.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042021\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515645,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":100.00,\"rangeValue\":100.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042008\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515646,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":94.00,\"rangeValue\":94.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"},{\"bizType\":\"297086\",\"devId\":\"bfe240bf1cb9e53e06dxtg\",\"dpId\":\"114\",\"dt\":\"2022042007\",\"gmtCreate\":1650607531000,\"gmtModified\":1650607531000,\"id\":6515647,\"ownerId\":\"37821555\",\"pid\":\"nccooqhf\",\"price\":93.00,\"rangeValue\":93.00,\"status\":1,\"timeType\":1,\"uid\":\"eu1589895786310s8RxP\"}]";
        List<SolutionDeviceDpStatBaseEntity> historyDeviceDpStat = JSONObject.parseObject(_a, new TypeReference<>() {
        });
        // log.info("getUnit pid [{}] divisor [{}] dpPidUnit [{}]", pidList.get(0), divisor, dpPidUnit);
        String pid = "nccooqhf";
        BigDecimal divisor = new BigDecimal(1000);
        String dpPidUnit = "bnj74wzm,9kae5tt1,cophlynd,pz37a80t,7asqoekk,t61wqwm5,bzcbfxcg,e6rs3pan";

        // 计算总量
        List<StatListVO> list = new ArrayList<>();
        BigDecimal total = historyDeviceDpStat.stream()
                .filter(Objects::nonNull).peek(it -> {
                    StatListVO statListVO = new StatListVO();
                    statListVO.setDt(it.getDt());
                    statListVO.setPrice(it.getPrice());
                    statListVO.setRangeValue(it.getRangeValue().divide(divisor, 2, BigDecimal.ROUND_HALF_UP).doubleValue());
                    list.add(statListVO);
                })
                .map(SolutionDeviceDpStatBaseEntity::getRangeValue)
                .reduce(BigDecimal.ZERO, BigDecimal::add).setScale(2, BigDecimal.ROUND_HALF_UP);
        System.out.println(total);
    }

}
